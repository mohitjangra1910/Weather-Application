pipeline {     
    agent any      
    stages {         
        stage('Install Dependencies') {             
            steps {                 
                // Install Node.js (if not already installed)                 
                sh '''                 
                # Check if Node.js is installed, if not install it                 
                if ! command -v node &> /dev/null                 
                then                     
                    echo "Node.js not found. Installing Node.js..."                     
                    curl -fsSL https://deb.nodesource.com/setup_16.x | sudo -E bash -                     
                    sudo apt-get install -y nodejs                 
                else                     
                    echo "Node.js is already installed: $(node -v)"                 
                fi                 
                '''                 
                // Install npm dependencies                 
                sh 'npm install'             
            }  
        }
        stage('Run Tests') {             
            steps {                 
                sh 'npm test'             
            }         
        }         
        stage('Build') {             
            steps {                 
                sh 'npm run build'             
            }         
        }         
        stage('Deploy') {             
            steps {                 
                sh '''                 
                pm2 stop app || true                 
                pm2 start app.js --name "node-app"                 
                '''             
            }         
        }     
    }      
    post {         
        success {             
            echo 'Build, Test, and Deployment Successful!'         
        }         
        failure {             
            echo 'Build Failed. Check logs!'         
        }     
    } 
}

